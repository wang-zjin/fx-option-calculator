# 外汇期权计算器 — 如何使用与验证

面向使用方与验收方：如何运行、操作界面，以及如何验证结果是否正确。

---

## 日常使用（以后每次）

**方式一：一键启动（推荐）**

- 在项目目录下双击 **`启动Web界面.command`**，或在终端执行 **`./启动Web界面.sh`**。  
  脚本会自动安装依赖（如需）、启动开发服务器并打开浏览器到 Vanilla 定价页。

**方式二：手动命令**

1. **打开终端**，进入项目目录：  
   `cd "外汇期权计算器"`（或您的实际路径）
2. **启动**：执行 `npm run dev`，等终端出现 `Local: http://localhost:5173/`。
3. **用浏览器打开**：访问 **http://localhost:5173/**，填参数后点「计算」即可。

> 首次使用或依赖变更后需先执行一次 `npm install`（一键脚本会自动执行）。  
> 详细说明与验证方法见下文。

---

## 一、环境要求

- 本机已安装 **Node.js**（建议 v18+）和 **npm**。
- 在项目根目录打开终端。

---

## 二、运行方式

### 1. 安装依赖（首次或依赖变更后）

```bash
npm install
```

### 2. 开发模式（本地调试）

```bash
npm run dev
```

启动后，在浏览器访问终端提示的地址（通常为 **http://localhost:5173**）。修改代码后页面会自动刷新。

### 3. 构建生产包（部署前）

```bash
npm run build
```

构建产物在 `dist/` 目录，可部署到 Nginx 或任意静态托管。

### 4. 本地预览构建结果

```bash
npm run preview
```

用于确认生产构建后的页面与功能是否正常（例如排查「生产构建白屏」等问题）。

---

## 三、界面使用（Vanilla 定价页）

1. **打开页面**：运行 `npm run dev` 后访问上述地址，当前为单页「Vanilla 定价」。
2. **填写输入**：
   - **货币对**：下拉选择（如 EURUSD、USDJPY、**USDCNY**、GBPUSD、AUDUSD）或「其他」。
   - **当前日期**：默认加载为**当天日期**；可改。
   - **起息日**：默认**当前日期 + 2 个交易日**（T+2，遇周末、节假日顺延）；可改。
   - **到期日**：支持**日期选择**或**手输简写**：如 `1M`（1 个月后）、`1Y`（1 年后），相对当前日期解析；失焦后可自动解析为日期并联动交割日。
   - **交割日**：默认**到期日 + 2 个交易日**（遇周末、节假日顺延）；可改。顺序需满足：当前 ≤ 起息 ≤ 到期 ≤ 交割。
   - **即期 S、执行价 K**：正数，与货币对报价方式一致。
   - **本币利率 r_d、外币利率 r_f**：小数输入（如 4% 填 `0.04`）。
   - **名义本金**：外币单位，正数。
   - **买卖方向**：Long 多头 / Short 空头。
   - **期权类型**：Call 看涨 / Put 看跌。
   - **隐含波动率 σ**：小数（如 6% 填 `0.06`），须 > 0。
3. **货币对模板**：切换货币对时，即期、执行价、本币/外币利率、波动率、名义本金会填入该币种默认模板，只需微调尾数即可。
4. **计算**：点击「计算」按钮；若有校验错误会在对应输入旁显示，修正后再次点击「计算」。
5. **查看结果**：输出区展示期权价格、Premium（本币/外币及 % of spot）、Delta、Gamma（每 1% 即期）、Vega（每 1% vol）、Vanna、VolGamma/Volga、Time Decay、Phi、Rho、Theta 等（含「每单位名义」与「头寸」口径）。

---

## 四、如何验证结果是否正确

### 1. 使用需求书参考案例做回归

- 打开 [需求书/需求书-Vanilla-Web定价界面.md](./需求书/需求书-Vanilla-Web定价界面.md) 第八节「参考案例参数」。
- 在界面中填入相同参数（默认表单已预填该组参数）：
  - 当前日期 2025-12-29，起息日 2025-12-31，到期日 2026-01-28，交割日 2026-01-30
  - 即期 1.1575，执行价 1.15，本币利率 0.040897679，外币利率 0.018984441，隐含波动率 0.062372965
  - 名义本金 1,000,000，Long，Put
- 点击「计算」后，将页面上的**期权价格、Premium、Delta、Theta/Time Decay** 与参考脚本 `验证Fenics_EURUSD_20251229.py`（若存在）或既有验收基准对比，在约定精度内一致（如金额小数点后 2 位、比率 4 位）。

### 2. 校验逻辑自检

- **日期**：把「到期日」改成早于「当前日期」或打乱顺序，应出现校验提示且无法得到正确结果（若已实现「到期日 ≥ 当前日期」校验，会提示错误）。
- **数值**：即期、执行价、名义本金、波动率填 0 或负数，应提示「须 > 0」等；波动率填极大值（如 2 以上）时，若有上限校验会提示。

### 3. 买卖方向与符号

- **Long Put**：头寸 Delta 应为负（外币）；Premium 为正（支付期权费）。
- **Short**：同一合约下，头寸 Delta、Vega、Time Decay 等应与 Long 符号相反（界面已按「头寸 = Greeks × 名义本金 × 买卖方向」处理）。

### 4. USDCNY 自检（可选）

- 货币对选择 **USDCNY**，即期/执行价按「1 美元兑多少人民币」填写（如即期 7.25、执行价 7.20），本币利率为 CNY 利率、外币利率为 USD 利率，名义本金为外币（USD）；点击「计算」应正常得到期权价格、Premium（CNY）、Greeks。

### 5. 构建与访问

- 执行 `npm run build` 无报错，再执行 `npm run preview`，在浏览器打开预览地址，确认页面正常显示、计算功能可用（可再次用上述参考案例点一次「计算」）。

---

## 五、遇到问题怎么办

- **计算或展示异常**：记录当前输入参数与页面输出（或截图），按 [Issues/README.md](./Issues/README.md) 在 `Issues/` 对应分类下新建 Issue，交给问题调试团队。
- **构建/运行报错**：记录完整报错信息、Node 与 npm 版本，同上提交到 `Issues/构建与部署/` 或 `Issues/环境与工具/`。

---

**文档结束**。测试团队负责维护本文档与 [测试团队工作说明.md](./测试团队工作说明.md)。
