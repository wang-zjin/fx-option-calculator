# Issue：输入校验缺少「到期日 ≥ 当前日期」

- **日期**：2025-01-30
- **分类**：前端与UI

---

## 现象

- 需求书规定：**当前日期** 必须 ≤ 起息日、≤ **到期日**。
- 当前 `src/utils/validation.ts` 仅校验：当前 ≤ 起息、起息 ≤ 到期、到期 ≤ 交割；**未校验「到期日 ≥ 当前日期」**。
- 若用户误将「到期日」选为早于「当前日期」，T1 = (到期日−当前日期)/365 会为负，d1/d2 与定价公式在负 T 下行为异常或结果无意义，且无前端提示。

复现：将「当前日期」设为 2026-02-01、「到期日」设为 2026-01-28，其余保持合法；提交计算仍通过校验并得到结果。

---

## 原因

- 校验函数 `validateVanillaInput` 未包含「到期日 ≥ 当前日期」这一条规则。

---

## 解决方案

1. 在 `src/utils/validation.ts` 的 `validateVanillaInput` 中增加一条校验：
   - 若 `maturity < today`（到期日早于当前日期），则设置 `err.maturityDate = '到期日必须 ≥ 当前日期'`（或等价文案）。
2. 保持其余日期顺序校验不变（当前 ≤ 起息 ≤ 到期 ≤ 交割）。
3. 回归：用上述复现步骤验证，应出现「到期日必须 ≥ 当前日期」提示且不执行计算。

---

## 相关链接 / 参考

- 需求书 [需求书-Vanilla-Web定价界面.md](../../需求书/需求书-Vanilla-Web定价界面.md) 第二节：当前日期必须 ≤ 起息日、≤ 到期日。

---

## 备注

- 由测试团队发现并提交；已按上述方案在 `src/utils/validation.ts` 中增加「到期日必须 ≥ 当前日期」校验并合并，测试团队回归通过后可关闭。
