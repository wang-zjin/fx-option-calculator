# 外汇期权计算器 — 功能规格：期权类型与定价

本文档定义各期权类型的**收益结构**、**定价模型**、**输入/输出**，作为开发与验收依据。

---

## 一、期权类型总览

| 类型 | 说明 | 定价模型 | 优先级建议 |
|------|------|----------|------------|
| **Vanilla（香草期权）** | 欧式看涨/看跌 | Black-Scholes (Garman-Kohlhagen 外汇版) | P0 首期 |
| **数字期权** | 到期 payoff 为固定金额 or 0 | 解析公式（基于 BS） | P0 首期 |
| **美式期权** | 可提前行权 | 二叉树 / 三叉树 / 有限差分 | P0 首期 |
| **亚式期权** | 收益依赖平均价（均价看涨/看跌） | 解析近似 or 蒙特卡洛 | P1 |
| **其他奇异期权** | 障碍、回望、篮子等 | 按具体类型 | P2 扩展 |

---

## 二、Vanilla 期权（欧式香草）

### 2.1 定义与收益

- **看涨**：到期 payoff = max(S_T − K, 0)，S_T 为到期即期汇率。
- **看跌**：到期 payoff = max(K − S_T, 0)。
- **标的**：外汇即期 S；报价方式按市场惯例（如 EURUSD 即期、执行价、利率等）。

### 2.2 定价模型

- **Garman-Kohlhagen 模型**（外汇版 Black-Scholes）：
  - 输入：即期 S、执行价 K、到期 T、本币无风险利率 r_d、外币无风险利率 r_f、波动率 σ。
  - 输出：期权价格（本币单位）、Delta / Gamma / Vega / Theta / Rho（及跨式相关敏感度可选）。

### 2.3 输入/输出规格

| 输入 | 含义 | 示例/单位 |
|------|------|-----------|
| 即期汇率 S | 标的汇率 | 如 1.0850 (EURUSD) |
| 执行价 K | Strike | 与即期同报价方式 |
| 到期期限 T | 年化时间 | 如 0.25（3 个月） |
| 本币无风险利率 r_d | 计价货币利率 | 如 0.05 (5%) |
| 外币无风险利率 r_f | 标的货币利率 | 如 0.03 (3%) |
| 波动率 σ | 年化隐含/历史波动率 | 如 0.10 (10%) |
| 期权类型 | Call / Put | — |

| 输出 | 含义 |
|------|------|
| 期权价格 | 每单位名义本币价值 |
| Delta | ∂V/∂S |
| Gamma | ∂²V/∂S² |
| Vega | ∂V/∂σ（通常按 1% 波动率变化） |
| Theta | ∂V/∂t（通常按 1 天） |
| Rho_d / Rho_f | 对本币/外币利率的敏感度（可选） |

---

## 三、数字期权（Digital / Binary）

### 3.1 定义与收益

- **看涨数字**：若 S_T ≥ K 支付固定金额 D（如 1 单位本币），否则 0。
- **看跌数字**：若 S_T ≤ K 支付固定金额 D，否则 0。
- 可有「现金或无」(Cash-or-Nothing) 与「资产或无」(Asset-or-Nothing)，首期可先做 Cash-or-Nothing。

### 3.2 定价模型

- 在 Black-Scholes/Garman-Kohlhagen 假设下，**解析公式**：
  - Cash-or-Nothing 看涨：D · e^{−r_d T} · N(d_2)
  - Cash-or-Nothing 看跌：D · e^{−r_d T} · N(−d_2)
  - 其中 d_2 与 Vanilla BS 中一致。
- 输入与 Vanilla 类似，额外需要**支付金额 D**（及支付货币）。

### 3.3 输入/输出规格

| 输入 | 在 Vanilla 基础上增加 |
|------|------------------------|
| 支付金额 D | 触发时支付的固定金额（如 1） |
| 支付货币 | 本币 / 外币（影响折现） |

| 输出 | 含义 |
|------|------|
| 数字期权价格 | 本币计价的公允价值 |
| Delta（可选） | 对即期的敏感度（在 K 附近可能很大） |

---

## 四、美式期权

### 4.1 定义与收益

- 与 Vanilla 收益相同（max(S−K,0) 或 max(K−S,0)），但**可在到期前任意时刻行权**。
- 无股息/无离散利息时，美式看涨不提前行权，价格等于欧式；**美式看跌**可能提前行权，价格 ≥ 欧式看跌。

### 4.2 定价模型

- **二叉树（Cox-Ross-Rubinstein）或三叉树**：步数足够时收敛到美式价格。
- 外汇版本：在每节点用 r_d、r_f 做贴现，与 Garman-Kohlhagen 一致。
- 可选：有限差分（PDE）或 LSM（蒙特卡洛）做校验，首期以**二叉树/三叉树**为主即可。

### 4.3 输入/输出规格

| 输入 | 与 Vanilla 相同，可增加 |
|------|--------------------------|
| 树步数 | 如 100、200（影响精度与速度） |

| 输出 | 含义 |
|------|------|
| 美式期权价格 | 本币计价 |
| 与欧式价格差 | 便于理解提前行权价值 |
| Delta（数值） | 由树节点差分得到 |
| 早期行权边界（可选） | 可后续扩展 |

---

## 五、亚式期权（Asian）

### 5.1 定义与收益

- 收益依赖**标的在存续期内的平均价格**（通常算术平均）。
  - **均价看涨**：max(A_T − K, 0)，A_T 为平均价。
  - **均价看跌**：max(K − A_T, 0)。
- 平均方式：离散（如每日收盘）或连续平均；采样频率需在输入中约定。

### 5.2 定价模型

- **解析近似**：如 Turnbull-Wakeman 等（对几何平均有闭式，算术平均用近似）。
- **蒙特卡洛**：通用、可处理离散采样与任意平均方式，首期可用 MC 作为主方案或与解析对照。
- 输入需增加：**平均类型**（算术/几何）、**采样频率**（每日/每周等）。

### 5.3 输入/输出规格

| 输入 | 在 Vanilla 基础上增加 |
|------|------------------------|
| 平均类型 | 算术 / 几何 |
| 采样频率 | 每日 / 每周 / 自定义（如 252 个观测日） |

| 输出 | 含义 |
|------|------|
| 亚式期权价格 | 本币计价 |
| 若用 MC：标准误 / 置信区间（可选） | 评估数值误差 |

---

## 六、其他奇异期权（扩展 P2）

以下可在首期完成 Vanilla、数字、美式、亚式后再迭代：

| 类型 | 收益简述 | 常用方法 |
|------|----------|----------|
| **障碍期权** | 触及/未触及某障碍 H 则生效或失效 | 解析（BS 修正）、树、MC |
| **回望期权** | 依赖存续期内最高/最低价 | 解析（部分）、MC |
| **篮子期权** | 多标的线性组合的 Vanilla 型 payoff | 解析近似、MC |
| **幂期权** | payoff ∝ (S_T − K)^n 等 | 解析或 MC |

可在「功能规格」中为每种单独写一页：收益、模型、输入/输出。

---

## 七、通用约定（所有类型）

1. **报价与单位**：即期、执行价、利率、波动率单位在 UI 与文档中统一（如利率 5% 输入 0.05 或 5，需明确）。
2. **利率与期限**：T 为年化（如 3 个月 = 0.25）；r_d、r_f 为连续复利年化，与 Garman-Kohlhagen 一致。
3. **名义本金**：计算器可先做「单位名义」价格（如 1 单位外币），UI 上再支持输入名义本金得到总价。
4. **Greeks**：Vanilla 与数字期权可提供解析 Greeks；美式、亚式以数值 Greeks 为主（树或 MC 差分）。

---

## 八、开发顺序建议（对应计算模块）

1. **Phase 0**：公共基础设施（正态 CDF N(x)、Garman-Kohlhagen 的 d1/d2、折现因子）。
2. **Phase 1**：Vanilla 欧式定价 + Greeks（Garman-Kohlhagen）。
3. **Phase 2**：数字期权（Cash-or-Nothing）解析定价。
4. **Phase 3**：美式期权（二叉树/三叉树），先看跌。
5. **Phase 4**：亚式期权（蒙特卡洛 或 解析近似）。
6. **Phase 5**：障碍、回望等按需扩展。

UI 上可按「期权类型」下拉选择：Vanilla / 数字 / 美式 / 亚式，再根据类型展示对应输入项与输出项。
